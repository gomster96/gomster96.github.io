---
title: '엔티티 매핑과 연관관계'
date: 2022-02-24 20:50:08
category: 'JPA'
draft: false
---

<!-- <p align="center"><img src="1.png" height="200px" width="500px"></p> -->

# JPA에서 엔티티 매핑 하기

## 객체와 테이블 매핑 - @Entity

- 클래스 위에 `@Entity` 어노테이션이 붙으면 JPA가 관리하고, 이를 엔티티라고 부른다.
- JPA를 사용해서 테이블과 매핑할 클래스는 반드시 `@Entity` 어노테이션이 붙어야한다.
- 주의할 점
  - 기본 생성자(파라미터가 없는 public or protected 생성자)가 필수적으로 있어야한다.
  - 저장할 필드에 final 사용 불가
  - final 클래스, enum, inteface 등의 클래스 사용 불가

### @Entity의 속성

name

- JPA 에서 사용할 엔티티 이름을 지정한다.
- 기본값은 클래스 이름을 그대로 사용한다.

## 객체와 테이블 매핑 - @Table

`@Table` 은 엔티티와 매핑할 테이블을 직접 지정하는 것을 말한다. 즉 DB에 있는 테이블을 따로 지정해주어야 할 때 사용한다.

- name : 매핑할 테이블 이름을 지정한다.

## 필드와 컬럼 매핑 - @Column

데이터베이스 테이블의 컬럼과 객체의 필드를 직접 매칭해준다.

### @Column 속성

name

- 필드와 매핑할 테이블의 컬럼 이름 (default = 객체의 필드 이름)

insertable, updatable

- 등록, 변경 가능 여부를 지정한다 (default = true)

nullable

- null 값의 허용 여부를 설정한다 (default = not null)

length

- 문자 길이 제약조건, String 타입에만 사용한다 (default = 255)

precision, scale

- BigDecimal, 이나 아주 큰 소수 등을 사용할 때 즉 아주 큰 숫자나 정밀한 소수를 다루어야할 때 사용한다.

## 필드와 컬럼 매핑 - @Enumerated

자바의 enum 타입을 매핑할 때 사용한다.

EnumType.ORDINAL을 사용하면 enum순서를 데이터베이스에 저장하므로, 새로운 값이 바뀔 때 순서가 바뀐다면 데이터베이스에는 순서가 저장되어있는데 객체의 값이 변함에 따라 객체의 내용과 DB의 내용이 의도했던 바와 다르게 꼬일 수 있기 떄문에 반드시 `EnumType.STRING` 을 사용해야한다.

## 필드와 컬럼 매핑 - 그 외

- @Temporal

  날짜 타입(java.util.Date, java.util.Calendar)을 매핑할 때 사용한다. 하지만 최근에 사용하는 LocalDate, LocalDateTime을 사용할 때는 생략 가능하다.

- @Transient
  주로 메모리상에서만 임시로 어떤 값을 보관하고 싶을 때 사용한다.

## 기본 키 매핑

- @Id

  PK로 만들어준다.

- @GeneratedValue

  PK를 자동으로 생성해준다.

# 연관관계 매핑

연관관계 매핑이란 DB테이블의 관계를 매핑하는 것을 의미한다.

- 방향(Direction) : 단방향, 양방향
- 다중성(Multiplicity) : 다대일(N:1), 일대다(1:N), 일대일(1:1), 다대다(N:M)
- 연관관계의 주인(Owner) : 객체 양방향 연관 관계에서 기준이 되어 값이 변경되었을 때 서로 관계되어있는 값을 변경해줄 관계의 주인이 필요하다.

## 연관 관계의 주인

JPA는 전에 말했듯이 자바에서 객체를 다루는 것처럼 DB의 테이블을 다루는 것이 모토였다. 하지만 객체와 테이블은 관계를 맺는 것에서 다음과 같은 차이를 가진다.

- 객체의 연관 관계 : 객체의 양방향은 결국 단방향 연관이 2개라는 뜻이다.
- 테이블의 연관 관계 : 테이블의 연관관계는 한쪽만 연결되면 결국 양방향이 된다.
  - `외래 키` 하나로 두 테이블의 연관관계를 관리할 수 있기 때문에

따라서 객체에서 양방향 매핑을 하면, 참조가 2군데 존재하기 때문에 두 객체의 중 하나를 `연관관계의 주인`으로 삼아야 한다.

- 둘 중에 하나로 외래키를 관리(등록, 수정)하도록 해야한다.
- 관계의 주인이 아닌 쪽은 읽기만 가능하도록 해야 한다.
- 주인은 mappedBy 속성 사용 X
- 주인이 아니면 mappedBy 속성으로 주인을 지정해야한다.
- `외래키가 있는 곳을 연관관계의 주인`으로 해야만 한다.

## N:1

- 항상 "다" 에 즉 N에 외래키가 가도록 짜야 한다.
- `@JoinColumn` 어노테이션을 사용하여 외래키를 설정한다.
- 외래키가 있는 곳을 연관 관계의 주인으로 만들어야 한다. 따라서 반대쪽 (주인이 아닌곳)은 그냥 mappedBy로 주인이 되는 외래키가 무엇인지 적는다.

## 1:N

## 1:1

## N:M

# Reference

- [김영한, 자바 ORM 표준 JPA 프로그래밍 - 기본편](https://www.inflearn.com/course/ORM-JPA-Basic)
